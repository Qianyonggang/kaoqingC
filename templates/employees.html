{% extends 'base.html' %}
{% block title %}员工总览{% endblock %}
{% block content %}
<div class="card p-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">员工总览（跨团队共享）</h5>
    <a class="btn btn-outline-primary btn-sm" href="{{ url_for('teams') }}">去团队中维护员工</a>
  </div>

  <form method="get" class="mb-3">
    <div class="input-group">
      <input name="q" class="form-control" placeholder="搜索姓名" value="{{ query_text }}">
      <button class="btn btn-outline-secondary">搜索</button>
    </div>
  </form>



  <form method="post" class="border rounded p-3 mb-3 bg-light">
    <div class="row g-3">
      <div class="col-md-6">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <label class="form-label fw-semibold mb-0">选择团队（可多选）</label>
          <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-secondary" onclick="toggleChecked('team_ids', true)">全选</button>
            <button type="button" class="btn btn-outline-secondary" onclick="toggleChecked('team_ids', false)">反选</button>
          </div>
        </div>
        <div class="border rounded p-2 bg-white" style="max-height: 180px; overflow-y: auto;">
          {% for t in teams %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="team_ids" value="{{ t.id }}" id="team_{{ t.id }}">
            <label class="form-check-label" for="team_{{ t.id }}">{{ t.name }}</label>
          </div>
          {% else %}
          <div class="text-muted small">暂无团队</div>
          {% endfor %}
        </div>
      </div>
      <div class="col-md-6">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <label class="form-label fw-semibold mb-0">选择员工（可多选）</label>
          <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-secondary" onclick="toggleChecked('employee_ids', true)">全选</button>
            <button type="button" class="btn btn-outline-secondary" onclick="toggleChecked('employee_ids', false)">反选</button>
          </div>
        </div>
        <div class="border rounded p-2 bg-white" style="max-height: 180px; overflow-y: auto;">
          {% for e in items %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="employee_ids" value="{{ e.id }}" id="employee_{{ e.id }}">
            <label class="form-check-label" for="employee_{{ e.id }}">{{ e.name }}</label>
          </div>
          {% else %}
          <div class="text-muted small">暂无员工</div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="mt-3 d-flex justify-content-between align-items-center">
      <small class="text-muted">可同时选择团队和员工，系统将合并后清空对应员工全部考勤。</small>
      <button class="btn btn-danger" onclick="return confirm('确认清空所选团队/员工的全部考勤信息吗？');">清空考勤信息</button>
    </div>
  </form>

  <table class="table table-sm align-middle">
    <tr><th>姓名</th><th>日薪</th><th>所属团队</th><th>详情</th></tr>
    {% for e in items %}
      <tr>
        <td>{{ e.name }}</td>
        <td>{{ e.daily_salary }}</td>
        <td>{% for t in e.teams %}<span class="badge text-bg-light border">{{ t.name }}</span> {% endfor %}</td>
        <td><a class="btn btn-sm btn-outline-primary" href="{{ url_for('employee_detail', employee_id=e.id) }}">查看详情</a></td>
      </tr>
    {% else %}
      <tr><td colspan="4" class="text-muted">没有匹配员工</td></tr>
    {% endfor %}
  </table>
</div>

<script>
  function toggleChecked(inputName, pickAll) {
    const items = document.querySelectorAll(`input[name="${inputName}"]`);
    items.forEach((el) => {
      el.checked = pickAll ? true : !el.checked;
    });
  }
</script>
{% endblock %}
